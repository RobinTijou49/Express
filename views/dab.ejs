<%- include("header") %>

<h1 class="u-center"><%= title %></h1>

<div class="grid">
  <aside>
    <div class="card">
      <h3>Retrait</h3>
      <form action="/dab" method="post">
        <div class="form-row">
          <label for="montant">Montant</label>
          <input 
            id="montant" 
            name="montant" 
            type="number" 
            step="0.01" 
            min="0" 
            value="<%= typeof montant !== 'undefined' ? montant : '' %>" 
            required 
          />
        </div>

        <div class="form-row">
          <label for="devise">Devise</label>
          <select id="devise" name="devise">
            <option value="€" <%= (devise === '€') ? 'selected' : '' %>>€</option>
            <option value="$" <%= (devise === '$') ? 'selected' : '' %>>$</option>
          </select>
        </div>

        <div class="mt-8">
          <button class="btn" type="submit">Calculer</button>
        </div>
      </form>
    </div>
  </aside>

  <section>
    <div class="card result-card">
      <% if (!result) { %>
        <div class="u-center muted">Soumettez un montant pour afficher la distribution</div>
      <% } else if (result.error) { %>
        <p class="muted" style="color:#ff9a9a">
          <strong>Erreur :</strong> <%= result.error %>
        </p>
      <% } else { %>
        <div class="result-header">
          <div>
            <h3 class="mb-8">Résultat</h3>
            <div class="small muted">
              Pour <strong><%= (result.montant || montant) %> <%= (result.devise || devise) %></strong>
            </div>
          </div>
          <div class="small muted">
            Reste: <%= result.remaining || '0.00' %> <%= (result.devise || devise) %>
          </div>
        </div>

        <% if (Object.keys(result.distribution).length === 0) { %>
          <div class="muted">Aucune coupure nécessaire.</div>
        <% } else { %>
          <div class="result-list">
            <% for (let denom in result.distribution) { %>
              <div class="result-item">
                <div><strong><%= denom %></strong></div>
                <div class="muted"><%= result.distribution[denom] %></div>
              </div>
            <% } %>
          </div>
        <% } %>
      <% } %>
    </div>
  </section>
</div>

<% include footer %>
